#cloud-config

# For more information on how autoinstall is configured, please refer to
# https://ubuntu.com/server/docs/install/autoinstall-reference
autoinstall:
  version: 1
  # Disable ssh server during installation, otherwise packer tries to connect and exceed max attempts
  early-commands:
    - systemctl stop ssh
  # Configure the locale
  locale: en_US.UTF-8
  keyboard:
    layout: en
    variant: us
  updates: 'all'
  ssh:
    install-server: true
    allow-pw: true
  # Customize the list of packages installed.
  packages:
    - open-vm-tools
  # Create the default user.
  # Ensures the "builder" user doesn't require a password to use sudo.
  user-data:
    users:
      - name: builder
        # openssl passwd -6 -stdin <<< builder
        passwd: $6$xyz$UtXVazU08Q5b8AW.TJ3MPYZglyXa3Ttf2RCel8MCUPlEYO1evWxeWBhZ2QqivU/Ij4tqYAxMCqc2ujEM4dMSe1
        groups: [adm, cdrom, dip, plugdev, lxd, sudo]
        lock-passwd: false
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/bash

  # This command runs after all other steps; it:
  # 1. Reset network interface IDs
  late-commands:
    - curtin in-target --target=/target -- rm -f /etc/udev/rules.d/70-persistent-net.rules
